package shlm.lmcs.com.lazycat.LazyShopAct;import android.Manifest;import android.annotation.SuppressLint;import android.app.AlertDialog;import android.os.Bundle;import android.os.Handler;import android.os.Message;import android.support.v4.app.ActivityCompat;import android.view.LayoutInflater;import android.view.View;import android.view.animation.AlphaAnimation;import android.widget.ImageView;import android.widget.TextView;import com.bumptech.glide.Glide;import java.util.Timer;import java.util.TimerTask;import shlm.lmcs.com.lazycat.LazyCatProgramUnt.CompanyAct.LazyCatAct;import shlm.lmcs.com.lazycat.LazyCatProgramUnt.CompanyTools.TextUnt;import shlm.lmcs.com.lazycat.LazyCatProgramUnt.CompanyTools.XmlBuilder;import shlm.lmcs.com.lazycat.LazyCatProgramUnt.Tools;import shlm.lmcs.com.lazycat.LazyShopValues.LocalAction;import shlm.lmcs.com.lazycat.R;/** * 加载宣传广告 */public class PromotionAct extends LazyCatAct {    private ImageView promotion_img;/*图片的容器*/    private TextView btn_close;/*关闭广告*/    private Timer timer;    private int count = 3;/*2秒内关闭广告*/    private final int HANDLER_MSG = 1;    private Handler handler;    private AlertDialog alertDialog;    @SuppressLint("HandlerLeak")    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setTransparentBar();        setContentView(R.layout.activity_promotion);        promotion_img = findViewById(R.id.activity_promotionImageview);        btn_close = findViewById(R.id.activity_promotionBtnColose);        handler = new Handler() {            @Override            public void handleMessage(Message msg) {                switch (msg.what) {                    case HANDLER_MSG:                        if (msg.obj.toString().trim().equals("0")) {                            LazyCatActStartActivity(MainAct.class, true);                            timer.cancel();                        }                        break;                }                super.handleMessage(msg);            }        };        init();    }    @SuppressLint("NewApi")    private void init() {        /*判断是否获取到地址权限*/        if (Tools.isPermission(getApplicationContext(), Manifest.permission                .ACCESS_COARSE_LOCATION)) {        } else {            AlertDialog.Builder builder = new AlertDialog.Builder(PromotionAct.this);            View item = LayoutInflater.from(PromotionAct.this).inflate(R.layout.alert_message,                    null);            TextView btn_confirm = item.findViewById(R.id.alert_messageBtnConfirm);            TextView Tv_title = item.findViewById(R.id.alert_messageTitle);            TextUnt.with(Tv_title).setText("请求授权");            TextView Tv_context = item.findViewById(R.id.alert_messageText);            TextUnt.with(Tv_context).setText("检测到您没有开启定位权限,请您开启定位权限用来获取您的店铺位置.如果没有定位信息," +                    "程序将无法获取到数据连接.如果您无法打开您手机的定位权限,请联系仓库的管理人员。");            btn_confirm.setOnClickListener(new View.OnClickListener() {                @Override                public void onClick(View v) {                    ActivityCompat.requestPermissions(PromotionAct.this, new String[]{Manifest                            .permission.ACCESS_COARSE_LOCATION}, 0);                    alertDialog.dismiss();                    alertDialog = null;                }            });            TextUnt.with(btn_confirm).setText("马上去开启");            builder.setView(item);            if (alertDialog == null) {                alertDialog = builder.show();            }        }        /*尝试获取界面信息*/        XmlBuilder.XmlInstance xmlInstance = new XmlBuilder.XmlInstance();        xmlInstance.initDom();        /*提交的经度的信息*/        xmlInstance.setXmlTree(LocalAction.ACTION_PROMOTIONACT.ACTION_LOCAL_LONG, "");        /*提交的维度的信息*/        xmlInstance.setXmlTree(LocalAction.ACTION_PROMOTIONACT.ACTION_LOCAL_LAT, "");        /*提交的城市的ID*/        xmlInstance.setXmlTree(LocalAction.ACTION_PROMOTIONACT.ACTION_LOCAL_CITYCODE, "");        xmlInstance.overDom();        /*测试加载*/        Glide.with(this).load("http://120.79.63.36/Photos/ConfigMain/shzService/Welcome" +                "/welcome_msg.png").into(promotion_img);        //*逐渐显示*/*/        AlphaAnimation alphaAnimation = Tools.createOnalpha(500, true);        promotion_img.startAnimation(alphaAnimation);        /*设置关闭按钮的颜色*/        btn_close.setBackground(Tools.CreateDrawable(1, "#000000", "#000000", 50));        btn_close.setAlpha(0.5f);        btn_close.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                timer.cancel();                LazyCatActStartActivity(MainAct.class, true);                finish();            }        });        /*开启线程*/        timer = new Timer();        timer.schedule(new TimerTask() {            @Override            public void run() {                Message msg = new Message();                msg.what = HANDLER_MSG;                msg.obj = count--;                if (count < 0) {                    timer.cancel();                }                handler.sendMessage(msg);            }        }, 0, 1000);    }}